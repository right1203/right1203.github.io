---
layout: post
title: "[GCP] 구글 클라우드 플랫폼으로 분석 환경 무료로 만들기"
subtitle: "GCP - Tensorflow"
categories: tool
tags: gcp
comments: true
---

### Tensorflow을 활용한 딥러닝 분석 환경 구축

저와 같은 학생들에게 딥러닝을 공부하면서 가장 큰 문제는 컴퓨팅 능력일 것입니다.

큰 데이터를 활용해서 많은 노드와 여러 개의 레이어를 쌓은 신경망을 노트북의 보잘것없는 CPU로 학습하려고 하면 정말 오래 걸립니다.

그래서 꾸역꾸역 공개된 서버의 Jupyter Notebook을 활용해서 학습하더라도 기본적으로 몇 시간, 넘어서는 몇 일 동안 학습을 진행하는 모습에 가슴이 답답해져서 GCP를 이용하고자 마음 먹었습니다.

GCP(Google Cloud Platform)은 구글에서 Compute Engine, Storage, Network 등을 클라우드 환경에서 빌려 사용하고 사용한 만큼  금액을 지불하는 서비스입니다.

**하지만 GCP를 처음 사용하는 이용자에게 $300의 크레딧을 제공하고 이를 이용하여 무료로 GCP를 이용할 수 있게 합니다!**

<span style="color:red">~~또한 이 크레딧은 계정마다 지급하며, 구글 계정은 여러개를 만들 수 있습니다.~~</span>

그래서 지금부터 GCP를 이용하여 간단하게 Tensorflow-gpu를 사용할 수 있는 분석 환경을 구축하는 방법을 알아보겠습니다.

---

### 1. GCP 활성화

GCP 링크 : https://console.cloud.google.com

사이트에 접속하면 우측 상단에 다음과 같이 무료로 크레딧을 줍니다.

![1](/_posts/assets/2018-09-30-gcp-datalab/1.PNG)

그리고 진행되는 사항에 따라 이름, 도시, 주소, 전화번호, 신용카드 정보를 입력하시면 됩니다.

오른쪽에서도 안내하는 것처럼 30일이 지난다고 해서 여타 사이트(Coursera 등)와 같이 꼼수를 부려 자동 결제는 되지 않으니 안심하셔도 될 것 같습니다.

<br/>

### 2. GPU 자원 할당 요청

CPU와 메모리, 저장 공간 등은 GCP를 활성화하면 바로 할당 받을 수 있지만, GPU 자원은 별도의 할당 요청을 통해 할당을 받아야 합니다.

이번에는 GPU 중 그나마 가격이 저렴한 NVIDIA의 Tesla K80 GPU를 할당 받아보겠습니다.

![2](/_posts/assets/2018-09-30-gcp-datalab/2.PNG)

우선 위와 같이 좌측 상단의 네비게이션 바를 선택하여 메뉴 창을 여시고, 'IAM 및 관리자' 카테고리의 할당량을 선택해줍니다.

![3](/_posts/assets/2018-09-30-gcp-datalab/3.PNG)

할당량 증가를 요청하려면 업그레이드 해야한다고 나옵니다.

하지만 계정 업그레이드 버튼을 클릭만 하면 위와 같이 계정이 업그레이드 됩니다! (왜 하라는건지?)

![4](/_posts/assets/2018-09-30-gcp-datalab/4.PNG)
![5](/_posts/assets/2018-09-30-gcp-datalab/5.PNG)

상단의 위치를 **us-east1**으로 변경하고 할당량을 요청할 **K80**을 클릭하여 활성화 후 **+할당량 수정** 을 클릭합니다.
(다른 위치여도 상관은 없습니다만, K80 GPU가 존재하고 상대적으로 가격이 저렴한 위치라 골랐습니다)

이후 할당량을 1개로 설정하고 GPU를 요청하는 이유를 적으시면 되는데, 저는 Tensorflow 실험을 위해 필요하다고 하였습니다.

메일을 통해 할당되었다고 답변이 오는데 평일 기준, 1일 정도가 소모되었습니다.

> 첫 계정을 사용할 때는 현재 할당량이 0 이었으나, 포스팅을 위해 계정을 추가로 생성하였더니 현재 할당량이 초기부터 1으로 되어있네요. 만약, 현재 할당량이 1로 되어있다면 추가로 요청을 하지 않아도 됩니다.

<br/>

### 3. Compute Engine VM 생성

이제 컴퓨터 자원을 할당받고, VM(가상머신)을 만들어야 합니다.

VM을 만드는 이유는 할당 받은 컴퓨터 자원을 효율적으로 분배하여 사용하고, 어느 환경에서도 접속할 수 있도록 해주기 떄문입니다.

VM 인스턴스를 생성해보겠습니다.

![6](/_posts/assets/2018-09-30-gcp-datalab/6.PNG)

위와 같은 창에서 Compute Engine을 선택합니다. 만약 이 창이 뜨지 않는다면, 좌측 상단의 메뉴 창을 선택하고 Compute Engine을 선택하면 됩니다.

![7](/_posts/assets/2018-09-30-gcp-datalab/7.PNG)

VM 인스턴스를 만들어줍시다.

![8](/_posts/assets/2018-09-30-gcp-datalab/8.PNG)

저는 위와 같이 설정하였습니다.

코어와 메모리는 원하시는 만큼 설정하시면 됩니다. 다만 자원이 많아지고 성능을 향상시킬수록 시간 당 요금은 비싸지니 잘 선택하시기 바랍니다.

또한 GPU를 K80으로 할당하였고, 만약 K80 GPU가 선택사항에 없다면 다른 지역을 선택하시기 바랍니다.

OS는 가장 환경이 잘 구축되어있는 Ubuntu 16.04 LTS를 선택하였고,
디스크는 80GB를 할당하였습니다.

또한 방화벽에 HTTP/HTTPS 모두 트래픽 허용하였습니다.

이렇게 인스턴스를 생성하시면 모든 자원을 할당받아 가상머신을 생성하였습니다.

>이 가상머신은 동작 중인 시간만큼 요금이 계산되기 때문에 사용하지 않는다면 끄는 것을 추천합니다.

---

글이 길어져서 여기까지만 작성하고, 다음 포스팅에서 분석 환경을 만들기 위해 Tensorflow-gpu가 설치된 Jupyter Notebook을 docker를 통해 손쉽게 구축해보겠습니다.
